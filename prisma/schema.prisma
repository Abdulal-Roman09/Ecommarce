generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id       String     @id @default(uuid())
  email    String     @unique
  password String
  role     UserRole   @default(CUSTOMER)
  status   UserStatus @default(ACTIVE)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  admin    Admin?
  vendor   Vendor?
  customer Customer?
  payments Payment[]
  orders   Order[]

  @@map("users")
}

model Admin {
  id String @id @default(uuid())

  email String @unique
  user  User   @relation(fields: [email], references: [email])

  name          String
  profilePhoto  String?
  contactNumber String

  isDelete  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("admins")
}

model Vendor {
  id String @id @default(uuid())

  email String @unique
  user  User   @relation(fields: [email], references: [email])

  name          String
  profilePhoto  String?
  contactNumber String
  gender        Gender
  address       String
  rating        Float      @default(0)
  isVerified    Boolean    @default(false)
  isDelete      Boolean    @default(false)
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  shops         Shop[]
  categories    Category[]

  @@map("vendors")
}

model Customer {
  id String @id @default(uuid())

  email String @unique
  user  User   @relation(fields: [email], references: [email])

  name           String
  contactNumber  String
  profilePhoto   String?
  presentAddress String

  isDelete  Boolean  @default(false)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("customers")
}

model Category {
  id    String @id @default(uuid())
  title String
  icons String

  products          Product[]
  productCategories ProductCategory[]
  vendors           Vendor[]

  @@map("categorys")
}

model Product {
  id          String  @id @default(uuid())
  name        String
  brand       String
  description String?
  basePrice   Float
  image       String?

  categoryId String
  category   Category @relation(fields: [categoryId], references: [id])

  shopId String
  shop   Shop   @relation(fields: [shopId], references: [id])

  createdAt         DateTime          @default(now())
  updatedAt         DateTime          @updatedAt
  productCategories ProductCategory[]
  inventory         Inventory?
  orderItems        OrderItem[]

  @@map("products")
}

model ProductCategory {
  categoryId String
  category   Category @relation(fields: [categoryId], references: [id])

  procductId String
  product    Product @relation(fields: [procductId], references: [id])

  @@id([procductId, categoryId])
  @@map("produc_categorys")
}

model Shop {
  id          String  @id @default(uuid())
  name        String  @unique
  description String? @db.Text
  logo        String?
  banner      String?
  email       String  @unique
  phone       String?
  address     String?
  isActive    Boolean @default(true)
  isVerified  Boolean @default(false)

  vendorId String?
  vendor   Vendor? @relation(fields: [vendorId], references: [id])

  products  Product[]
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  payments  Payment[]
  orders    Order[]

  @@map("shops")
}

model Inventory {
  id  String @id @default(uuid())
  sku String @unique

  productId String?  @unique
  product   Product? @relation(fields: [productId], references: [id])

  quantity  Int
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  histories History[]

  @@map("inventories")
}

model History {
  id              String     @id @default(uuid())
  actionType      ActionType
  quantityChanged Int
  lastQuantity    Int
  newQuantity     Int

  inventoryId String
  inventory   Inventory @relation(fields: [inventoryId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("histories")
}

model Payment {
  id            String @id @default(uuid())
  amount        Float
  transactionId String @unique

  orderId String @unique
  order   Order  @relation(fields: [orderId], references: [id])

  userId String
  user   User   @relation(fields: [userId], references: [id])

  shopId String
  shop   Shop   @relation(fields: [shopId], references: [id])

  currency String        @default("BDT")
  status   PaymentStatus @default(PENDING)

  paymentGatewayData Json?
  paidAt             DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("payments")
}

model Order {
  id String @id @default(uuid())

  userId String
  user   User   @relation(fields: [userId], references: [id])

  shopId String
  shop   Shop   @relation(fields: [shopId], references: [id])

  totalAmount Float
  discount    Float @default(0)
  shippingFee Float @default(0)
  grandTotal  Float

  status        OrderStatus   @default(PENDING)
  paymentStatus PaymentStatus @default(PENDING)

  shippingAddress Json
  billingAddress  Json?

  orderItems OrderItem[]
  payment    Payment?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("orders")
}

model OrderItem {
  id String @id @default(uuid())

  orderId String
  order   Order  @relation(fields: [orderId], references: [id])

  productId String
  product   Product @relation(fields: [productId], references: [id])

  quantity Int
  price    Float
  total    Float

  createdAt DateTime @default(now())

  @@map("order_items")
}

enum UserRole {
  SUPER_ADMIN
  ADMIN
  VENDOR
  CUSTOMER
}

enum UserStatus {
  ACTIVE
  BLOCKED
}

enum Gender {
  MALE
  FEMALE
}

enum ActionType {
  IN
  OUT
}

enum PaymentStatus {
  PENDING
  PAID
  FAILED
  REFUNDED
}

enum OrderStatus {
  PENDING
  CONFIRMED
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
}
